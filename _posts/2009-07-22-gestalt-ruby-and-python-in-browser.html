---
title: "Gestalt: Ruby and Python in the browser, again"
layout: "post"
permalink: "/2009/07/gestalt-ruby-and-python-in-browser.html"
uuid: "8442058915742893952"
guid: "tag:blogger.com,1999:blog-5419182.post-8442058915742893952"
date: "2009-07-22 03:06:00"
updated: "2009-07-22 03:06:15"
description: 
blogger:
    siteid: "5419182"
    postid: "8442058915742893952"
    comments: "8"
categories: [IronRuby, Silverlight, IronPython, DLR]
author: 
    name: "Jimmy Schementi"
    url: "https://plus.google.com/116380716127564408544?rel=author"
    image: "//lh6.googleusercontent.com/-Fl3zUgl9dMw/AAAAAAAAAAI/AAAAAAAABYQ/CvQezyGiMP4/s512-c/photo.jpg"
---

<div class="post-content">
<p>Today <a href="http://visitmix.com/Lab" target="_blank">Mix Online Lab</a> released a prototype implementation of Ruby and Python in the browser, named <a href="http://visitmix.com/Labs/gestalt/" target="_blank">Gestalt</a>. Feeling a bit of de ja vu? If not, you can ignore this post and just <a href="http://visitmix.com/labs/gestalt/learnmore/" target="_blank">see what it’s all about</a>. Regardless, I suggest you read on.</p>  <p>A simple Ruby-based web page using Gestalt would look like this:</p> <script src="http://gist.github.com/151756.js"></script>  <p><a href="http://visitmix.com/Labs/gestalt/" target="_blank">Gestalt</a> adds “ruby” and “python” to the languages supported by the &lt;script&gt; tag. You can also include other files rather than writing the code in the HTML page:</p> <script src="http://gist.github.com/151758.js"></script>  <p>My first reactions when hearing about this project was “Holy crap, wow, they got Ruby and Python running in the browser, that’s freakin’ awesome!” But I work on the <a href="http://silverlight.net" target="_blank">Silverlight</a> integration with <a href="http://ironruby.net" target="_blank">IronRuby</a> and <a href="http://ironpython.codeplex.com" target="_blank">IronPython</a>, already letting you write Ruby and Python in the browser instead of JavaScript. Hmm. Not to my surprise, Gestalt uses IronRuby and IronPython in Silverlight to accomplish this. But damn, wouldn’t it be awesome if this is how the world worked?</p>  <p><em><font color="#ff8000">For any new readers, <a href="http://ironruby.net" target="_blank">IronRuby</a> and <a href="http://ironpython.codeplex.com" target="_blank">IronPython</a> are implementations of Ruby and Python for the .NET Framework, utilizing the <a href="http://dlr.codeplex.com" target="_blank">Dynamic Language Runtime</a> (DLR).</font></em></p>  <p><a href="http://visitmix.com/Labs/gestalt/" target="_blank">Gestalt</a> is a effort to show what it would be like if there were other <strong><font color="#ff8000">standard</font></strong> languages in the browser, other than just JavaScript. The Mix Online Lab focuses on using Microsoft technology in ways that make non-Microsoft developers interested, so this project is right up their alley. They wanted to showcase the DLR languages in Silverlight as a way of showing how our efforts can make the web a better place.</p>  <h4><font color="#ff8000">So what are the difference between IronRuby and IronPython’s Silverlight integration and what Gestalt provides?</font></h4>  <p>Again, you can already make IronRuby and IronPython based applications in Silverlight; Gestalt just puts a new spin on how to do that. IronRuby and IronPython use the XAP file for the application packaging, including script files, and provides a development-tool called Chiron to auto-package the app, providing the edit-refresh experience that is familiar for a web browser app. Chiron is also used to write the package to disk so it can be deployed to any web-server. This model works great for getting new and existing Ruby and Python programs running in Silverlight, as the packaging is transparent to a developer. And it doesn’t fight Silverlight’s packaging conventions, so using Silverlight-specific features will be straight-forward from a DLR language.</p>  <p><a href="http://visitmix.com/Labs/gestalt/" target="_blank">Gestalt</a> takes a much different approach using &lt;script&gt; tags, making the integration much more familiar to current JavaScript developers. They also handle all the Silverlight &lt;object&gt; tag stuff in gestalt.js, taking away the need to host Silverlight yourself.</p>  <h4><font color="#ff8000">Why Gestalt is interesting to me</font></h4>  <p>The thing that I really like about Gestalt is that Chiron is not needed for development. Just edit the file and refresh the browser. No need to run something in the background generating a XAP file. Gestalt.js detects which languages the page’s &lt;script&gt; tags use, and picks a pre-packaged Gestalt-*.xap file, one for Ruby, one for Python, one for both, and one for none. This means your application could look something like this:</p>  <ul>   <li>index.html (can contain Python and/or Ruby code) </li>    <li>gestalt/      <ul>       <li>gestalt.js </li>        <li>gestalt-rb.xap </li>        <li>gestalt-py.xap </li>        <li>gestalt.xap </li>        <li>gestalt-x.xap </li>     </ul>   </li> </ul>  <p>Very clean. The gestalt directory is just dropped onto your web-server (to be shared among all your applications), and gestalt.js is referenced from your HTML file, and your good to go. No running Chiron.exe, or installing Mono on the Mac to run Chiron.exe. I’m jealous.</p>  <h4><font color="#ff8000">So what’s the catch?</font></h4>  <p>While Gestalt is a much simpler to get started writing Ruby and Python applications in the browser, it does not support a major feature of Ruby and Python – accessing something like a file-system. For example, including other files at runtime uses the language’s underlying File access to read the file in and run it’s contents. Ruby uses “require” or “load”, and python uses “import” to do this.</p>  <p>IronRuby and IronPython in Silverlight normally support this, as all file reads are redirected to the XAP file. Since Gestalt’s XAP files are opaque to the the developer, they do not support File access. This is only an issue when you want to use existing Ruby or Python code in the browser. For example, existing code usually has more dependencies, especially into portion of the language’s standard library which is written the language itself. Usually you’d just put these files in the folder that Chiron is auto-xapping for you, and that’s it. However, Gestalt has no way of doing this today.</p>  <h4><font color="#ff8000">Making it better</font></h4>  <p>A possible solution is to just cache the contents of &lt;script src&gt; tags, and use the languages path resolution mechanism to test if those files have already been downloaded. If it finds a match, serve the file’s contents. If not, it could either fail fast and say that your missing a &lt;script src&gt; reference, or it <em>COULD </em>download the file synchronously (and still cache it) and display a warning that you are missing a &lt;script src&gt; reference.</p>  <p>Unfortunately, this only works for script files; what if you just want to download a txt file? Having &lt;script src=”foo.txt”&gt; is not going to fly. Maybe using &lt;link&gt; tags could work?</p>  <p><font color="#ff8000"><strong>Why can’t we just download them synchronously?</strong></font> No! Though the current bits do have a synchronous downloading mode, it’s only experimental and should not be used in production. Synchronous downloads are significantly slower since only one download can occur at a time. Downloads need to be synchronous since “opening a file” is expected to block until it is complete. Also, IronRuby/IronPython do not support <a href="http://en.wikipedia.org/wiki/Continuation" target="_blank">continuations</a> (for good reasons), so the code cannot be “paused” while a file is downloaded, and then be “resumed” when done. And even if they did support continuations (as there is a way to get it working for the very specific case of file access), the downloads would still all occur one at a time, making the loading much slower. So <font color="#ff8000"><strong>downloading “on-demand” for file reads is not a good solution</strong></font>, and that’s precisely why the browser doesn’t do that today … so let’s not fight it.</p>  <h4><font color="#ff8000">Is Gestalt going to always be separate from IronRuby and IronPython?</font></h4>  <p>No! :) While Gestalt’s first release was best to be separate, I’m very interested in merging the ideas Gestalt has back into Microsoft.Scripting.Silverlight … <a href="http://lists.ironpython.com/pipermail/users-ironpython.com/2009-July/010813.html" target="_blank">in-fact discussions have already begun on the IronPython Mailing List</a>.</p>  <p>In short, Ruby and Python Silverlight applications are a bit too complex, and Gestalt shows us that it doesn’t need to be that way. <a href="http://github.com/jschementi/ironruby/commit/da6b54e226adfd3a18d8ad98d618c2350ebd8351" target="_blank">Work has already begun to merge Gestalt and Microsoft.Scripting.Silverlight</a>, so play with Gestalt and let me know what you think!</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:a1a7afdb-3168-465b-bb90-b04b0cfa1b40" class="wlWriterEditableSmartContent">Technorati Tags: <a href="http://technorati.com/tags/IronRuby" rel="tag">IronRuby</a>,<a href="http://technorati.com/tags/IronPython" rel="tag">IronPython</a>,<a href="http://technorati.com/tags/DLR" rel="tag">DLR</a>,<a href="http://technorati.com/tags/Silverlight" rel="tag">Silverlight</a>,<a href="http://technorati.com/tags/Browser" rel="tag">Browser</a>,<a href="http://technorati.com/tags/Ruby" rel="tag">Ruby</a>,<a href="http://technorati.com/tags/Python" rel="tag">Python</a>,<a href="http://technorati.com/tags/dynamic+languages" rel="tag">dynamic languages</a></div>  
</div>