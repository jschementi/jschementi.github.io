---
title: "Testing C# Silverlight apps with IronRuby"
layout: "post"
permalink: "/2009/03/testing-c-silverlight-apps-with.html"
uuid: "6495545690239862724"
guid: "tag:blogger.com,1999:blog-5419182.post-6495545690239862724"
date: "2009-03-27 09:32:00"
updated: "2009-03-29 08:01:39"
description: 
blogger:
    siteid: "5419182"
    postid: "6495545690239862724"
    comments: "2"
categories: [Testing, IronRuby, Silverlight]
author: 
    name: "Jimmy Schementi"
    url: "https://plus.google.com/116380716127564408544?rel=author"
    image: "//lh6.googleusercontent.com/-Fl3zUgl9dMw/AAAAAAAAAAI/AAAAAAAABYQ/CvQezyGiMP4/s512-c/photo.jpg"
---

<div class="post-content">
<a class="image-link" href="http://picasaweb.google.com/data/media/api/user/jschementi/albumid/5317377554695295809/photoid/5317377561395917954/1238048439764000?authkey=Gv1sRgCPWiwvPqh9OipAE"><img style="text-align: center; margin: 0px auto 10px; display: block" class="linked-to-original" src="http://picasaweb.google.com/data/media/api/user/jschementi/albumid/5317377554695295809/photoid/5317377558632300354/1238048439128000?authkey=Gv1sRgCPWiwvPqh9OipAE" width="380" height="304" /></a>   <p align="center"><a href="http://blog-well.com/2008/03/04/100-resources-for-web-developers/"><span style="font-size: xx-small">http://blog-well.com/2008/03/04/100-resources-for-web-developers/</span></a></p>  <p align="center"><em><a href="http://videos.visitmix.com/MIX09/T22F">&laquo; This post is part of the combined<br /> IronRuby and AgDLR release at MIX '09</a></em></p>  <p>Testing is a great use for dynamic languages, especially if the application being tested is written in a compiled language like C# or VB. <a href="http://www.ruby-lang.org/" target="_blank">Ruby</a> is an especially interesting language for writing tests in due to the popularity of <a href="http://rspec.info/" target="_blank">RSpec</a>, a <a href="http://en.wikipedia.org/wiki/Behavior_Driven_Development" target="_blank">behavior-driven-development</a> testing framework. <a href="http://ironruby.net/" target="_blank">IronRuby</a> makes it really easy to test .NET applications because of it's .NET integration and ability to run real Ruby programs, like RSpec. However, this becomes much more difficult to do in <a href="http://silverlight.net/" target="_blank">Silverlight</a> for a variety of reasons. And Silverlight doesn't have good options for testing to begin with, except for the <a href="http://silverlight.codeplex.com/" target="_blank">Silverlight Unit Test Framework</a>, but I yearn for something simpler. This post will show you how to test a C# Silverlight application with IronRuby, using a testing framework called <a href="http://github.com/chneukirchen/bacon/" target="_blank">Bacon, a lightweight RSpec clone</a>.</p>  <p style="clear: both"><em><b style="color: orange">Note</b>: A similar exercise could be performed with <a href="http://ironpython.codeplex.com/" target="_blank">IronPython</a> and a Python testing framework like unittest or PyUnit, but I have much less experience with writing test code in Python. If anyone else does, please feel free to put together a similar package for IronPython).</em></p>  <h4 style="color: orange">Demo: testing a calculator on steroids</h4>  <p style="color: red"><a href="http://lh6.ggpht.com/_OqCZhp9yI0Q/Sc8iZoQc44I/AAAAAAAAAIc/GP8C0EDwDIE/s1600-h/calculator-tests%5B4%5D.png"><img style="display: inline" title="calculator-tests" alt="calculator-tests" src="http://lh5.ggpht.com/_OqCZhp9yI0Q/Sc8iZ-oiUfI/AAAAAAAAAIg/tvbv80ON8Fw/calculator-tests_thumb%5B2%5D.png?imgmax=800" width="400" height="508" /></a> </p>  <p align="center"><a href="http://github.com/jschementi/mix09/zipball/3ccf72461e24a1b5b1fbc552294dcbff84762ccd">Download MIX '09 demos</a></p>  <p align="center">This example is in the <a href="http://github.com/jschementi/mix09/tree/3ccf72461e24a1b5b1fbc552294dcbff84762ccd/Calculator"><code>/Calculator</code></a> directory. Special thanks to <a href="http://itblobs.blogspot.com/" target="_blank">Boyan Nikolov</a> for implementing the <a href="http://itblobs.blogspot.com/2008/11/calculator-for-silverlight.html" target="_blank">Calculator control</a>.</p>  <p>This is a example of testing a calculator (I'll explain the right-side with the Python code in the next post); the tests run in their own text-based REPL console, and even let you poke and prod the application after it's finished running the tests. The tests are very succinct and read easily, showing a big advantage to using IronRuby.</p>  <p><script src="http://gist.github.com/87277.js"></script></p>  <p>The tests do not actually click the buttons, as Silverlight doesn't have extensive UI automation support like WPF does, but the tests call the methods that are hooked to the events, and also test that the controls hook the correct method, making it an equivalent test, and a lot less magic-y.</p>  <p>For another testing example, see the <a href="http://github.com/jflam/spreadsheet">spreadsheet example</a> <a href="http://www.iunknown.com">John Lam</a> put together for <a href="http://videos.visitmix.com/MIX09/T22F">his MIX '09 talk</a>.</p>  <h4 style="color: orange">Test any Silverlight app</h4>  <p>Testing any Silverlight application is pretty straight-forward, so let's walk through how to set it up. You can start from either your own Silverlight application, or a new Silverlight application, however you'll need a website/web-application project to be serving the actual Silverlight application; if you're creating a new application simply use the default options.</p>  <p>First, <a href="http://jimmy.schementi.com/silverlight/eggs.xap">download eggs.xap</a> (<a href="#eggs_explain">I'll explain what it is later</a>) and place it at the same location in your webserver as your application's XAP file is being served; most likely the ClientBin directory. If you put it anywhere else, make sure to account for that in the code below. <em>Note: Eggs.xap will be part of <a href="http://github.com/jschementi/agdlr" target="_blank">agdlr</a> in 0.5.1, which will come out in a week from this post's date</em>.</p>  <p style="clear: both">Next, <a href="http://jimmy.schementi.com/silverlight/Sample.Tests.zip">download this Web Application project</a>, rename it to whatever you want, and add it to the same solution as your Silverlight application; this will hold our tests.</p>  <p style="text-align: center; clear: both"><a style="margin-left: 1em; margin-right: 1em" href="http://4.bp.blogspot.com/_OqCZhp9yI0Q/Sc10ddcre8I/AAAAAAAAAIU/A7_14lzZp50/s1600-h/eggs-solution.png" imageanchor="1"><img border="0" src="http://4.bp.blogspot.com/_OqCZhp9yI0Q/Sc10ddcre8I/AAAAAAAAAIU/A7_14lzZp50/s320/eggs-solution.png" /></a></p>  <p style="clear: both">There is a <a href="http://github.com/jschementi/mix09/tree/f81084e069789de7979d2b340fad705826fa2c14/Sample.Tests" target="_blank">Sample.Tests/tests directory</a> in that project, with a single <a href="http://github.com/jschementi/mix09/blob/f81084e069789de7979d2b340fad705826fa2c14/Sample.Tests/Sample.Tests/tests/sample_test.rb" target="_blank">sample_test.rb file</a>; that where the actual tests will go. Youâ€™ll also see <a href="http://github.com/jschementi/mix09/blob/f81084e069789de7979d2b340fad705826fa2c14/Sample.Tests/Sample.Tests/eggs_config.rb" target="_blank">eggs_config.rb</a>; this file defines the list of tests we want to run, since Silverlight can't enumerate the files in a XAP file easily.</p>  <p>The <a href="http://github.com/jschementi/mix09/blob/f81084e069789de7979d2b340fad705826fa2c14/Sample.Tests/clientaccesspolicy.xml" target="_blank">clientaccesspolicy.xml</a> file makes it possible to download the generated XAP file, since our Silverlight application is being served from a different web-server. You can move these tests to the same domain as the application, but for the sake of this demonstration they are different.</p>  <p><script src="http://gist.github.com/86584.js">
</script></p>  <p style="clear: both">To get your application running the tests, add the following C# code to your application at the point which you want tests to run; this might be on Application_Startup, or at some later time ... it's up to you. If you're not sure, just add this code to the method which handles Application_Startup in App.xaml.cs to download eggs.xap and run the tests, only when the query string contains &quot;test&quot;.</p>  <p><script src="http://gist.github.com/86587.js">
</script></p>  <p style="clear: both">When it is all said and done, run your application with &quot;?test&quot; at the end of the URL, and you'll see something like this:</p>  <p><a href="http://lh4.ggpht.com/_OqCZhp9yI0Q/Sc8iaVW3A5I/AAAAAAAAAIk/MBY5faRrnE0/s1600-h/eggsfirstrun8.png"><img style="display: inline" title="eggs-firstrun" alt="eggs-firstrun" src="http://lh4.ggpht.com/_OqCZhp9yI0Q/Sc8ia6e9oWI/AAAAAAAAAIo/jvBeLPx92LA/eggsfirstrun_thumb6.png?imgmax=800" width="400" height="352" /></a></p>  <p>The tests run inside a HTML-based IronRuby REPL control, so you can inspect your application after the tests run, maybe to track down a failure or prototype your next test.</p>  <p><em><b style="color: orange">Note</b>: if you don't see the REPL in your application, or just see the REPL and not the red menu bar below, the Silverlight control is blocking its view. If you make your Silverlight control &quot;windowless&quot;, by adding <code>&lt;param name='windowless' value='true' /&gt;</code>&quot; to the Silverlight object tag, or <code>Windowless='True'</code> to the <a href="http://github.com/jschementi/mix09/blob/f81084e069789de7979d2b340fad705826fa2c14/Calculator/Calculator.Web/CalculatorTestAppTestPage.aspx" target="_blank">ASP.NET control which creates the object tag</a>, it will allow the REPL to show up. If for some reason you can't make your control windowless, you'll need to set the width and height of the Silverlight control so it doesn't overlap the console</em>.</p>  <h4 style="color: orange">How it works</h4>  <p>Everything above is pretty transparent on what it's doing, except for two parts: <span style="color: orange; font-weight: bold">(1) what is this &quot;eggs.xap&quot; thing</span>, and <span style="color: orange; font-weight: bold">(2) how did my tests magically become a XAP file?</span></p>  <a name="eggs_explain"></a> <h4 style="color: orange">Eggs</h4>  <p>&quot;eggs.xap&quot; is a small library to run Bacon in Silverlight. It containing <a href="http://github.com/jschementi/bacon/blob/9a301c14833b4b8a26b95f659cf52df8318edd86/lib/bacon.rb" target="_blank">bacon.rb</a>, the Bacon framework, <a href="http://github.com/jschementi/eggs/blob/cdeda77fc92d9ab907e86aed698ab2a2344993d7/lib/eggs.rb" target="_blank">eggs.rb</a>, a Bacon test runner for Silverlight, <a href="http://github.com/jschementi/eggs/blob/cdeda77fc92d9ab907e86aed698ab2a2344993d7/src/Eggs.cs">Eggs.dll</a>, a simple .NET API for running the tests, and DLLs required to run IronRuby.</p>  <p style="clear: both">When you added the code to App.xaml.cs, it:</p>  <ul>   <li>Downloaded eggs.xap </li>    <li>Pulled out Eggs.dll and loaded it </li>    <li>Runs the tests in the supplied XAP via &quot;Eggs.Start&quot; </li> </ul>  <p><a href="http://github.com/jschementi/eggs/blob/cdeda77fc92d9ab907e86aed698ab2a2344993d7/src/Eggs.cs"><code>Eggs.Start</code></a> loads IronRuby's DLLs and and uses the DLR Hosting APIs to call the Ruby <a href="http://github.com/jschementi/eggs/blob/cdeda77fc92d9ab907e86aed698ab2a2344993d7/lib/eggs.rb"><code>Eggs.run</code></a> method. This is abstracted by Eggs.dll so the application being tested doesn't need a compile-time dependency on IronRuby.</p>  <h4 style="color: orange">Chiron.XapHttpHandler</h4>  <p>All you did was put tests in a web application project, so how are they getting packaged up into a XAP file? In that project's <a href="http://github.com/jschementi/mix09/blob/f81084e069789de7979d2b340fad705826fa2c14/Sample.Tests/Web.config" target="_blank">web.config</a>, there's one very important line:</p>  <p><script src="http://gist.github.com/86951.js">
</script></p>  <p>Yes, Chiron's XAPing functionality is being used, but it's packaged in an ASP.NET HttpHandler, giving any ASP.NET application the ability to auto-XAP a directory when requested, without having to use Chiron's web-server functionality. So when you give <code>Eggs.start</code> the Uri to the tests (http://localhost:35863/Calculator.Tests.xap), it resolves to that project, sees that the Calculator.Tests folder exists but no XAP file exists, so it creates one in memory and responds to the request with it. <a href="http://github.com/jschementi/agdlr/blob/master/src/Chiron/XapHttpHandler.cs" target="_blank">Here is the implementation if you are curious</a>.</p>  <p>This same strategy can be used to develop Python or Ruby Silverlight applications in Visual Studio.</p>  <h4 style="color: orange">Now, get to testing!</h4>  <p>Now you have no excuses for not testing your Silverlight application! Hit me up on twitter (@jschementi) or the comments if you have any questions.</p>  
</div>