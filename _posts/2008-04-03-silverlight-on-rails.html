---
title: "Silverlight on Rails"
layout: "post"
permalink: "/2008/04/silverlight-on-rails.html"
uuid: "4388683167068909358"
guid: "tag:blogger.com,1999:blog-5419182.post-4388683167068909358"
date: "2008-04-03 19:52:00"
updated: "2008-05-04 09:06:08"
description: 
blogger:
    siteid: "5419182"
    postid: "4388683167068909358"
    comments: "7"
categories: [rails, assistment, Silverlight, RailsConf]
author: 
    name: "Jimmy Schementi"
    url: "https://plus.google.com/116380716127564408544?rel=author"
    image: "//lh6.googleusercontent.com/-Fl3zUgl9dMw/AAAAAAAAAAI/AAAAAAAABYQ/CvQezyGiMP4/s512-c/photo.jpg"
---

<div class="css-full-post-content js-full-post-content">
My “spare-time” project is to make a Silverlight plugin for Rails, which allows your controller/view code to either run on the server or the client. It's not available yet, but if you want it faster maybe making a big stink about it to <a href="http://twitter.com/maheshp">my boss</a> would work.

Here's a messy contrived example of what you could do with it, but it makes the point.

<pre class="textmate-source all_hallow_s_eve"><span class="source source_ruby source_ruby_rails"><span class="meta meta_rails meta_rails_controller"><span class="meta meta_class meta_class_ruby"><span class="keyword keyword_control keyword_control_class keyword_control_class_ruby">class</span> <span class="entity entity_name entity_name_type entity_name_type_class entity_name_type_class_ruby">FooController<span class="entity entity_other entity_other_inherited-class entity_other_inherited-class_ruby"> <span class="punctuation punctuation_separator punctuation_separator_inheritance punctuation_separator_inheritance_ruby">&lt;</span> ApplicationController</span></span></span>
  client <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>time</span>

  <span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">index</span></span>
    <span class="support support_function support_function_actionpack support_function_actionpack_rails">render</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>text</span> <span class="punctuation punctuation_separator punctuation_separator_key-value">=&gt;</span> <span class="string string_unquoted string_unquoted_heredoc string_unquoted_heredoc_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">&lt;&lt;-EOS</span>
      &lt;%= link_to_remote 'Show time', :url =&gt; {:action =&gt; 'time'} %&gt;
      &lt;br /&gt;&lt;div id=”time_div”&gt;&lt;/div&gt;
<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">    EOS</span></span>
  <span class="keyword keyword_control keyword_control_ruby">end</span>
 
  <span class="meta meta_function meta_function_method meta_function_method_without-arguments meta_function_method_without-arguments_ruby"><span class="keyword keyword_control keyword_control_def keyword_control_def_ruby">def</span> <span class="entity entity_name entity_name_function entity_name_function_ruby">time</span></span>
    <span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby"><span class="punctuation punctuation_definition punctuation_definition_variable punctuation_definition_variable_ruby">@</span>time</span> <span class="keyword keyword_operator keyword_operator_assignment keyword_operator_assignment_ruby">=</span> <span class="support support_class support_class_ruby">Time</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>now
    <span class="support support_function support_function_actionpack support_function_actionpack_rails">render</span> <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>update</span> <span class="keyword keyword_control keyword_control_start-block keyword_control_start-block_ruby">do </span><span class="punctuation punctuation_separator punctuation_separator_variable punctuation_separator_variable_ruby">|</span><span class="variable variable_other variable_other_block variable_other_block_ruby">page</span><span class="punctuation punctuation_separator punctuation_separator_variable punctuation_separator_variable_ruby">|</span>
      page<span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>insert_html <span class="constant constant_other constant_other_symbol constant_other_symbol_ruby"><span class="punctuation punctuation_definition punctuation_definition_constant punctuation_definition_constant_ruby">:</span>bottom</span> <span class="string string_quoted string_quoted_single string_quoted_single_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">'</span>time_div<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">'</span></span><span class="punctuation punctuation_separator punctuation_separator_object punctuation_separator_object_ruby">,</span> <span class="string string_quoted string_quoted_double string_quoted_double_ruby"><span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_begin punctuation_definition_string_begin_ruby">"</span><span class="source source_ruby source_ruby_embedded source_ruby_embedded_source"><span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">#{</span><span class="variable variable_other variable_other_readwrite variable_other_readwrite_instance variable_other_readwrite_instance_ruby"><span class="punctuation punctuation_definition punctuation_definition_variable punctuation_definition_variable_ruby">@</span>time</span><span class="punctuation punctuation_separator punctuation_separator_method punctuation_separator_method_ruby">.</span>to_s<span class="punctuation punctuation_section punctuation_section_embedded punctuation_section_embedded_ruby">}</span></span>&lt;br /&gt;<span class="punctuation punctuation_definition punctuation_definition_string punctuation_definition_string_end punctuation_definition_string_end_ruby">"</span></span>
    <span class="keyword keyword_control keyword_control_ruby">end</span>
  <span class="keyword keyword_control keyword_control_ruby">end</span>
</span><span class="keyword keyword_control keyword_control_ruby">end</span></span></pre>
<p>If someone visited /foo, it would show them a link saying “Show time”. The line that makes all the difference is <span style="font-family: courier new;">client :time</span>, so ...</p>
<ul><li>Without <span style="font-family: courier new;">client :time</span></li><ul><li><span style="font-family: courier new;">link_to_remote</span> call would generate a javascript <span style="font-family: courier new;">Ajax.Request(‘/foo/time’)</span></li><li>time would be run on the server</li><li><span style="font-family: courier new;">render :update</span> block would generate javascript to add the “server-generated” time to the bottom on the time div, and then be send back to the client to be run.</li></ul><li>With <span style="font-family: courier new;">client :time</span>
</li><ul><li>a copy of this controller would be sent to the client when someone visits <span style="font-family: courier new;">/foo</span>.</li><li><span style="font-family: courier new;">link_to_remote</span> call would use Silverlight to call the time action on the client</li><li><span style="font-family: courier new;">render :update</span> block would execute just as it says, without needing to generate javascript.
</li></ul></ul><p>The beauty of this is with <span style="font-weight: bold;">one line you’ve decided to run a bunch of server-side code on the client, and it just happens for you.</span></p>
<span style="font-size:150%; color: #ff9933" >This is better than sliced bread!</span><p>The Rails way of doing AJAX is by generating HTML on the sever and sending it back to the client with JavaScript that knows how to insert the HTML into the page. This is an awesome way to do it, but can be pretty heavy-weight if you're schlepping around a lot of HTML. In those cases it doesn't save much “response size” over just sending the whole page back again.</p><p>People overcome this by pushing some logic to the client. However, this leads to duplicate their Rails logic in JavaScript, and handle serializing/deserializing their ActiveRecord object by hand. This is just flat-out painful, and by the end of it you realize all this server-side Rails code you wrote is wasted.</p><p>This pattern of pushing server-side logic to the client is the approach big sites like <a href="http://twitter.com/jschementi">Twitter</a> and <a href="http://gmail.com/">GMail</a> have taken, and it’s really the best way to make web applications feel more responsive ... it’s the whole RIA thing and why <a href="http://silverlight.net/">Silverlight</a> is cool. <a href="http://twitter.com/">Twitter</a> went through a ton of <a href="http://highscalability.com/scaling-twitter-making-twitter-10000-percent-faster">growing pain</a> getting their app to scale well, and I can bet much of it was attributed to “what should we do on the client, and what should we do on the server” (and what should be cached and what should be stored in a database, but that's a different topic altogether).</p><p>I’d like to live in a world where you can write your entire app in Ruby, and not have to throw away a ton of code to get some of it running on the client. That’s what I’m trying to accomplish with this project.</p>
<span style="font-size:150%; color: #ff9933" >You're right, this is better than slided bread!</span><p>:-) Let me know what you think about this, and I'll get some code into your hands soon.</p>
<span style="font-size:85%; color: gray">As you can probably tell, this personally hit me hard. We had this problem with <a href="http://assistment3.cs.wpi.edu/">Assistment</a>. The tutor just wasn’t scaling, and we decided to port the whole thing to JavaScript, eagerly load data onto the client, etc ... all the things we expected our web framework to do for us. This pissed me off to no end, and <a href="http://dynamicsilverlight.net/">Ruby in Silverlight </a>is a way to undo those wrongs and make all this possible.</span>

<p><b>Update:</b> By the way, I got this example working today! Without "client :time" it works as usual, making an AJAX request when clicking on the "Show time" link. But when you add "client :time", clicking on "Show time" simply runs the code on the client! Awesome!</p><p>I'm probably going to put this up on RubyForge ... just not sure whether I should make my own project or stick it in the IronRuby? Regardless, code is coming =)</p>
</div>
<div class="css-full-comments-content js-full-comments-content">
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/13666102861045517530">
  <div class="css-comment-name js-comment-name">
    Josh
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-07T19:18:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    Wow this looks great.<BR/><BR/>The "link_to_remote" thing seems a bit awkward since it's being run on the client, though.  The "link_to_function" method would be more natural, since it's a local function, or better yet: "link_to_silverlight_function"<BR/><BR/>The client call at the beginning seems really clean.  Does it send the whole controller to the client, then?  That wasn't completely clear.
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/05370777584064015818">
  <div class="css-comment-name js-comment-name">
    Jimmy Schementi
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-11T08:46:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    The rational behind using link_to_remote is because I want the code to work regardless of whether "client :time" is there or not. Idea being you write you app without this client/server division in mind, but not have to rewrite any code when you  do make the "client or server" decision.<BR/><BR/>I wouldn't overload link_to_function when it takes a string, since code today depends on that being JavaScript. However, when it takes a block I could run it with Silverlight if available. <BR/><BR/>I'd definitely have link_to_silverlight_function, but its existence is unrelated to running controller code on the client. Granted, very useful though, as it's a much more explicit way to run code in Silverlight (and probably the lower hanging fruit =P).
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/05370777584064015818">
  <div class="css-comment-name js-comment-name">
    Jimmy Schementi
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-11T08:54:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    By the way, I got this example working today! Without "client :time" it works as usual, making an AJAX request when clicking on the "Show time" link. But when you add "client :time", clicking on "Show time" simply runs the code on the client! Awesome!<BR/><BR/>I'm probably going to put this up on RubyForge ... just not sure whether I should make my own project or stick it in the IronRuby? Regardless, code is coming =)
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/05370777584064015818">
  <div class="css-comment-name js-comment-name">
    Jimmy Schementi
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-11T09:18:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    Oh, and to answer you last question Josh:<BR/><BR/>"a copy of this controller would be sent to the client when someone visits /foo."<BR/><BR/>So today the entire controller is sent to the client. In the future, I'll also send down the views for all client actions as well (once I get erb working).<BR/><BR/>It'll be interesting to see if I can keep this "figuring out all the dependencies" game going =)
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://blog.prokrams.com">
  <div class="css-comment-name js-comment-name">
    Michael Letterle
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-11T11:55:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    That is pretty sweet, you should generalize it a bit though so you don't HAVE to use silverlight, be interesting to see what other hosts could be used. Moonlight for instance.  Very, very cool though.
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/13666102861045517530">
  <div class="css-comment-name js-comment-name">
    Josh
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-11T14:04:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    congratulations on getting it working!<BR/><BR/>I really like the idea of sending the views as well.<BR/><BR/>Are the controllers sent all at once, or is it on by request basis?  For example, someone requests /users/list<BR/>and the entire users controller gets sent down, along with all the view associated with that controller, or are they all sent in the initial request?
  </div>
  <br/>
</div>
<div class="css-full-comment js-full-comment">
  <div class="css-comment-user-link js-comment-user-link">
  <a href="http://www.blogger.com/profile/05370777584064015818">
  <div class="css-comment-name js-comment-name">
    Jimmy Schementi
  </div>
  </a>
  <div class="css-comment-date js-comment-date">
    2008-04-11T19:59:00.000Z
  </div>
  </div>
  <div class="css-comment-content js-comment-content">
    @michael: Well, if I give the code out today it will only work with Silverlight. =) Once Moonlight gets up to snuff then it'll just work in that as well. Though, the only requirement for a host is that it runs real Ruby in the browser; Silverlight is the only thing that does that today.<BR/><BR/>@josh: Gotta have views on the client if you're gonna run real controller code. =) <BR/><BR/>My thinking about "when do controllers go to the client" is whenever they're needed. Though, this is going to be hard, because for any rendered action, you need to see if there are any "links" to client actions. If so, the controller that action is in, plus any dependencies it may have on other controllers/modules/views, needs to be sent to the client. The  hard part is all these dependencies are dynamic (for instance, if you say "User" and it's not defined already, Rails will require /app/models/User.rb for you). Realistically, I may just send the controller, all the models, all the libs, and the actions views. <BR/><BR/>Another gotcha is "what if a client action calls another client action?" =) So, it's not such an easy problem, and I'm not gonna solve by speculating ... I'll just have to make it and go from there.
  </div>
  <br/>
</div>
</div>