---
title: "Scripting C# Silverlight apps with IronPython"
layout: "post"
permalink: "/2009/03/scripting-c-silverlight-apps-with.html"
uuid: "3027738289837249947"
guid: "tag:blogger.com,1999:blog-5419182.post-3027738289837249947"
date: "2009-04-02 11:16:00"
updated: "2009-04-03 00:18:52"
description: 
blogger:
    siteid: "5419182"
    postid: "3027738289837249947"
    comments: "2"
categories: [Silverlight, IronPython]
author: 
    name: "Jimmy Schementi"
    url: "https://plus.google.com/116380716127564408544?rel=author"
    image: "//lh6.googleusercontent.com/-Fl3zUgl9dMw/AAAAAAAAAAI/AAAAAAAABYQ/CvQezyGiMP4/s512-c/photo.jpg"
---

<div class="post-content">
<p align="center"><a title="2009-03-31 23:01:41 -0700 by jschementi, on Flickr" href="/images/flickr/3403091727_31220034d7_b.jpg"><img style="display: block; float: none; margin-left: auto; margin-right: auto" alt="2009-03-31 23:01:41 -0700" src="/images/flickr/3403091727_31220034d7_b.jpg" width="400" height="302" /></a></p>  <p align="center"><font color="#9a9a9a"><font size="1">Image is unrelated to the post; just an awesome view from my building</font></font></p>  <p align="center"><em><a href="http://videos.visitmix.com/MIX09/T22F">&laquo; This post is part of the combined<br /> IronRuby and AgDLR release at MIX '09</a></em></p>  <p style="clear: both">While many developers love to program in dynamic languages like Python or Ruby, they may not have that freedom in their day-to-day jobs, for a variety of tecnical and business reasons. However, dynamic languages are as useful when embedded in existing software, possibly making the design better than a non-scripting-enabled version. Languages based on the <a href="http://dlr.codeplex.com">dynamic language runtime</a> are really easy to embed in .NET applications, so hopefully this post inspires you to add scripting support to your applications.</p>  <p style="clear: both"><a href="http://blog.jimmy.schementi.com/2008/11/adding-scripting-to-c-silverlight-app.html" target="_blank">In a previous post, I showed how to build a C# Silverlight application which evaluated a line of dynamic language code and printed the result</a>. This post also touched on the philosophical issues around dynamic and static languages, so definitely give it a read first. Combining this with <a href="http://blog.jimmy.schementi.com/2009/03/testing-c-silverlight-apps-with.html" target="_blank">my most recent post about testing a C# Silverlight Calculator with IronRuby</a>, this post will walk you through adding the ability to define calculator functions in <a href="http://ironpython.codeplex.com" target="_blank">IronPython</a>.</p>  <p align="center"><a href="http://lh6.ggpht.com/_OqCZhp9yI0Q/SdSeR8sqouI/AAAAAAAAAIs/luLYD0EaDMg/s1600-h/ironpython-400%5B4%5D.png"><img style="display: block; float: none; margin-left: auto; margin-right: auto" title="ironpython-400" alt="ironpython-400" src="http://lh5.ggpht.com/_OqCZhp9yI0Q/SdSeSfk_wwI/AAAAAAAAAIw/2Wce441qXiM/ironpython-400_thumb%5B2%5D.png?imgmax=800" width="400" height="100" /></a></p>  <p style="clear: both"><em>Note: the same practices apply when scripting your application with </em><a href="http://ironruby.net" target="_blank"><em>IronRuby</em></a><em>, but itâ€™s been a while since I gave </em><a href="http://ironpython.codeplex.com" target="_blank"><em>IronPython</em></a><em> some love.</em></p>    <p><em>Also, <a href="http://blogs.msdn.com/kirillosenkov" target="_blank">Kirill Osenkov</a>, a C# IDE QA'er, wrote up a similar article about <a href="http://blogs.msdn.com/kirillosenkov/archive/2009/03/26/dlr-hosting-in-silverlight.aspx" target="_blank">Graphing IronPython functions in Silverlight</a>, so check that out as well.</em></p>  <p style="clear: both">First off, download the <a href="http://silverlight.net" target="_blank">Silverlight</a> Calculator solution that we will build upon.</p>  <h4 align="center"><a href="http://jimmy.schementi.com/silverlight/calculator-start.zip" target="_blank">Download Calculator (start)</a></h4>  <p align="center">To cheat or follow along while reading,    <br /><a href="http://github.com/jschementi/mix09/zipball/8a23b2c20cb578e45a8e82accab1f544761fa1eb" target="_blank">download the finished Calculator from the MIX '09 Demos repository</a>.</p>  <p style="clear: both"><strong><font color="#ff8000">Sanity check:</font> </strong>You'll need <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=53289097-73ce-43bf-b6a6-35e00103cb4b&amp;displaylang=en" target="_blank">ASP.NET MVC 1.0</a> and <a href="http://www.microsoft.com/downloads/details.aspx?FamilyID=11DC7151-DBD6-4E39-878F-5081863CBB5D&amp;displaylang=en" target="_blank">Silverlight 3 Tools</a> installed (SL2 might work, might not). Make sure <code>Calculator.Web</code> is the start project, and make sure CalculatorWebTestPage.aspx is the start page (both can be set by right-clicking on the respective files). Also make sure the site opens to <code>CalculatorTestAppTestPage.aspx?test</code> so that the tests run automatically. Compiling and running this solution should show you the following:</p>  <p align="center"><a href="/images/flickr/3406060409_9f08014037_c.jpg"><img alt="Calculator first run" src="/images/flickr/3406060409_9f08014037_c.jpg" width="373" height="500" /></a></p>  <p style="clear: both">This project gives us some UI to type Python code into (<a href="http://github.com/jschementi/mix09/blob/8a23b2c20cb578e45a8e82accab1f544761fa1eb/Calculator/CalculatorTestApp/Page.xaml">Page.xaml</a> will show you exactly what XAML creates this), and adds references to the <a href="http://ironpython.codeplex.com">IronPython</a> and <a href="http://dlr.codeplex.com/" target="_blank">DLR</a> binaries. </p>  <p align="center"><a href="/images/flickr/3406870674_53260df433_n.jpg"><img alt="What you need to host IronPython in Silverlight" src="/images/flickr/3406870674_53260df433_n.jpg" width="294" height="185" /></a></p>  <p style="clear: both"><b style="color: orange">Now for the interesting part</b>; building a <code>PythonEngine</code> class to encapsulate all the Python execution. Open <code>Calculator.Tests\Calculator.Tests\tests\python_engine_test.rb</code> (yes, Ruby is sneaking back into this post) and let's write some tests...</p>  <p><script src="http://gist.github.com/88882.js"></script></p>  <p>Now open <code>CalculatorTestApp\Page.xaml.cs</code> and add this to the CalculatorTestApp namespace to make those tests pass...</p>  <p style="clear: both"><script src="http://gist.github.com/86573.js"></script></p>  <p style="clear: both">Pretty simple. The code sets up a <code>ScriptEngine</code> for IronPython, executes arbitrary Python code in a shared scope, finds all the defined methods in that shared scope, and can call those methods with a single parameter. All in ~23 lines of code. Awesome. Here it is in action...</p>  <p align="center"><a href="/images/flickr/3406752302_b01578b25b_z.jpg"><img alt="Testing an IronPython engine with IronRuby" src="/images/flickr/3406752302_b01578b25b_z.jpg" width="400" height="193" /></a></p>  <p style="clear: both"><b style="color: orange">Now the Calculator is ready to be scripted</b>. The end goal is to:</p>  <ol>   <li>     <p style="clear: both">Execute the code as it's being typed into the Calculator</p>   </li>    <li>     <p style="clear: both">If it does not produce an error ... find out all the valid top-level methods defined by the code and add buttons to the UI for each method. </p>   </li>    <li>     <p style="clear: both">Clicking the button will call the appropriate method, sending the calculator's current result as a argument, and the return value will be the new result of the calculator. </p>   </li> </ol>  <p>So let's write tests for this ...</p>  <p><script src="http://gist.github.com/89101.js"></script></p>  <p>And the following will make it all pass...</p>  <p><script src="http://gist.github.com/86575.js"></script></p>  <p style="clear: both">And now giving it a run will produce the following:</p>  <p align="center"><a href="/images/flickr/3406729220_0c6fca109f_c.jpg"><img alt="Scripting Silverlight applications" src="/images/flickr/3406729220_0c6fca109f_c.jpg" width="354" height="500" /></a></p>  <p>Clicking the button's above the Python code will call that function, sending the Calculator's current value as the first argument. Pretty cool! And that's all there is to it. Adding scripting support to applications on the desktop is just as simple. So, don't be afraid of this new-found power, go build awesome stuff with it!</p>  
</div>