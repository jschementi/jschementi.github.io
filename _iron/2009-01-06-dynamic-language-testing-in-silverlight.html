---
title: "Dynamic Language Testing in Silverlight"
layout: "post"
permalink: "/2009/01/dynamic-language-testing-in-silverlight.html"
uuid: "601447514296991594"
guid: "tag:blogger.com,1999:blog-5419182.post-601447514296991594"
date: "2009-01-06 08:54:00"
updated: "2009-01-06 11:42:10"
description: 
blogger:
    siteid: "5419182"
    postid: "601447514296991594"
    comments: "0"
categories: [ruby, Testing, IronRuby, Silverlight]
author: 
    name: "Jimmy Schementi"
    url: "https://plus.google.com/116380716127564408544?rel=author"
    image: "//lh6.googleusercontent.com/-Fl3zUgl9dMw/AAAAAAAAAAI/AAAAAAAABYQ/CvQezyGiMP4/s512-c/photo.jpg"
---

<div class="post-content">
<p>A little less than two months ago I moved the Silverlight and DLR integration (AgDLR) project to <a href="http://github.com/jschementi/agdlr">http://github.com/jschementi/agdlr</a>, in an effort to get more collaboration. Since then <a href="http://github.com/Eloff">Dan Eloff</a> and <a href="http://github.com/markryall">Mark Ryall</a> have sent me pull requests, fixing up various error reporting, threading, and HTML bugs. Thanks guys! I promise to pull from you soon!</p>  <p>Anyway, a little while ago, Mark said:</p>  <blockquote>   <p><em><font color="#ff8000">I don't want to get all <a href="http://innovationcreators.com/wp/?p=204">Captain Agile</a> on you so soon but what do you think I can possibly add in the way of tests to verify that the change doesn't break anything?</font></em></p> </blockquote>  <p>Yeah, not having tests kind of sucks, doesn't it? Unfortunately, testing in Silverlight is a windy, confusing, one-lane road, so getting the infrastructure to run tests has taken some time, but I just committed a Silverlight <a href="http://github.com/jschementi/agdlr/tree/master/test/runner/ruby/app.rb">spec runner</a> for <a href="http://github.com/jschementi/bacon/">bacon</a> (a little Ruby spec framework) and a <a href="http://github.com/jschementi/agdlr/tree/master/test/runner/ruby/tests">bunch of specs</a> for <a href="http://github.com/jschementi/agdlr/tree/master/src/Microsoft.Scripting.Silverlight">Microsoft.Scripting.Silverlight</a>! </p>  <p>Here's a short screencast walking you through running the tests:</p>  <object width="400" height="300"><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="http://vimeo.com/moogaloop.swf?clip_id=2736262&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" /><embed src="http://vimeo.com/moogaloop.swf?clip_id=2736262&amp;server=vimeo.com&amp;show_title=1&amp;show_byline=1&amp;show_portrait=0&amp;color=&amp;fullscreen=1" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="400" height="300"></embed></object><br /><a href="http://vimeo.com/2736262">Testing AgDLR</a> from <a href="http://vimeo.com/user704813">Jimmy Schementi</a> on <a href="http://vimeo.com">Vimeo</a>.   <br />  <br />  <p>So, the tests are written in Ruby, but they test the C# code in Microsoft.Scripting.Silverlight ... pretty cool. This is a deviation from my common belief of &quot;test in the language you write the code in&quot;, but so what ... I never cared for that way of thinking =)</p>  <p>This test runner can be copied and used to test any Silverlight code; just place your test file in the <a href="http://github.com/jschementi/agdlr/tree/master/test/runner/ruby/tests">ruby/test</a> directory and update the test list in <a href="http://github.com/jschementi/agdlr/tree/master/test/runner/ruby/app.rb">ruby/app.rb</a>, and that's all their is to it. I'll probably pull it out into it's own git repository, but for now it's part of <a href="http://github.com/jschementi/agdlr">AgDLR</a>.</p>  <h4><font color="#ff8000">What took so long?</font></h4>  <p>Yeah yeah, two months without tests is crazy, especially since these tests were just written in the last two weeks! This being Microsoft and all, with an <a href="http://members.microsoft.com/careers/careerpath/technical/softwaretesting.mspx">entire discipline devoted to testing</a>, you'd think we have a ton of automated tests to verify our Silverlight integration. We'll we do. Kind of. Let me explain. </p>  <p align="center"><img src="http://www.nullislove.com/wp-content/uploads/2007/11/wrong_batteries.gif" width="300" height="237" /> </p>  <p>Currently AgDLR's tests are mostly in-browser tests, with some &quot;sanity&quot; tests running on the command-line. The command-line runner (which I can't release to the public) hosts <a target="_blank" href="http://en.wikipedia.org/wiki/Silverlight">CoreCLR</a>, but doesn't work exactly like the managed environment in Silverlight, which is why most are in-browser. The in-browser tests are comprised with a lot of &quot;does this feature of Silverlight work in the DLR&quot; tests, as well as more useful the IronPython and IronRuby test suite, and some end-to-end tests of sample applications (DLRConsole, Clock, etc). They run on an internal version of Microsft.Silverlight.Testing, which stop me from just releasing it, again.</p>  <p>Today these tests mainly run in a check-in system (the infamous SNAP, aka &quot;the troll&quot;), which runs tests in parallel over a bunch of machines. In SNAP, the Silverlight tests can take 30+ minutes themselves. <strong>On my laptop it takes about 5 hours!</strong> Basically useless for anyone wanting to contribute to AgDLR and run tests.</p>  <p align="center"><a href="/images/flickr/363202072_b3c2cb59c0_b.jpg/in/set-72157594405604955/"><img src="/images/flickr/363202072_b3c2cb59c0_b.jpg" width="300" height="251" /></a>&#160;</p>  <p align="left">Yeah, that's how it makes me feel too. Why they are like this is an entire different, and possibly inappropriate post, but I'll summarize. The issue is two fold: </p>  <p align="left"><font color="#ff8000"><strong>(1) The browser is killed after each test</strong></font></p>  <p><strong><font color="#ff8000"></font></strong></p>  <p align="left">Yeah, you heard me right. And each test has to run in both Firefox and IE. The tests are launched from a custom test harness, which launches the appropriate browser instance, and waits for the browser to say whether the test passed or failed, and gets any extra information like stack traces, error messages, etc. Sometimes this completion detection happens quick, but other times a failure never happens, so the test must timeout (60 seconds), and then it re-runs itself three times to make sure the timeout wasn't some fluke. Definitely no failing-fast happening here. Much of this is fixed in a newer version of Microsoft.Silverlight.Testing, but this is what's running today.</p>  <p align="left"><strong><font color="#ff8000">(2) The tests aren't unit tests</font></strong></p>  <p align="left">The tests exercise Silverlight features from DLR languages, rather than testing the integration between the two. Actually, the DynamicApplication class is never used in the tests!</p>  <p align="left">This makes a good point about testing in general. While end-to-end/sign-off/acceptance tests are wonderful things, they can't be all the tests. If I can't run the tests while developing, then I'm not going to run them period. Having a check-in system run them for you is fine, but I'd like to have a good chance at passing a 1.5 hour job the first time. </p>  <p></p>  <h4><font color="#ff8000">Solution: ditch it all</font></h4>  <p align="center"><a href="http://www.comicbookjournal.net/wp-content/uploads/2007/09/drawing-board.jpg"><img src="http://www.comicbookjournal.net/wp-content/uploads/2007/09/drawing-board.jpg" width="300" height="316" /></a> </p>  <p>To get tests out to the world, the only sane thing would be to head back to the drawing board, which is what I've done with test/runner. Hopefully by using existing open source projects, a testing paradigm most people understand, and a very small test runner, this testing solution for AgDLR will be kept small and friendly for developers.</p>  <p>So, now that there's a sane way to verify changes to AgDLR don't break, please fork AgDLR and send me pull requests! Next post will probably be about adding continuous integration to AgDLR, so stay tuned.</p>
</div>